name: P2P_Manual_Release

on:
  workflow_dispatch: # å¼€å¯æ‰‹åŠ¨è§¦å‘æŒ‰é’®
    inputs:
      version_tag:
        description: 'å‘å¸ƒç‰ˆæœ¬å· (ä¾‹å¦‚ v1.0.1)'
        required: true
        default: 'v1.0.0'
      release_note:
        description: 'æ›´æ–°è¯´æ˜'
        required: false
        default: 'ç¼–è¯‘å‘å¸ƒ - '

permissions:
  contents: write 

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: MSVC Extreme Build
        shell: cmd
        run: |
          call "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\VC\Auxiliary\Build\vcvars64.bat"
          # 1. ç¼–è¯‘èµ„æºæ–‡ä»¶
          rc.exe /nologo resource.rc
          # 2. ç¼–è¯‘å®¢æˆ·ç«¯ (é“¾æ¥èµ„æºæ–‡ä»¶ resource.res)
          cl.exe /nologo /O1 /MT /utf-8 client.c resource.res /link /subsystem:windows user32.lib gdi32.lib ws2_32.lib comctl32.lib /OUT:Control.exe
          # 3. ç¼–è¯‘æœåŠ¡ç«¯
          #cl.exe /O1 /MT /utf-8 server.c /link /subsystem:windows user32.lib gdi32.lib ws2_32.lib shell32.lib comctl32.lib /OUT:Service.exe
          cl.exe /nologo /O1 /MT /utf-8 server.c /link /subsystem:windows user32.lib gdi32.lib ws2_32.lib shell32.lib comctl32.lib /OUT:Service.exe

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            Control.exe
            Service.exe
          tag_name: ${{ github.event.inputs.version_tag }}
          name: "Release ${{ github.event.inputs.version_tag }}"
          body: |
            ### ğŸ›  æ‰‹åŠ¨è§¦å‘ç¼–è¯‘è¯´æ˜
            - **ç‰ˆæœ¬**: ${{ github.event.inputs.version_tag }}
            - **è¯´æ˜**: ${{ github.event.inputs.release_note }}
            ---
            - **ä½“ç§¯**: æè‡´ä½“ç§¯
            - **ç‰¹æ€§**: P2P/DXGI/é”å±çªç ´/å‰ªè´´æ¿/å¯†ä¿¡åŠ å¯†
          draft: false
          prerelease: false
