name: P2P_Manual_Release

on:
  workflow_dispatch: # å¼€å¯æ‰‹åŠ¨è§¦å‘æŒ‰é’®
    inputs:
      version_tag:
        description: 'å‘å¸ƒç‰ˆæœ¬å· (ä¾‹å¦‚ v1.0.1)'
        required: true
        default: 'v1.0.0'
      release_note:
        description: 'æ›´æ–°è¯´æ˜'
        required: false
        default: 'æ‰‹åŠ¨ç¼–è¯‘å‘å¸ƒ - ä¼˜åŒ–å¯†ä¿¡ä¼ è¾“ä¸å‰ªè´´æ¿åŒæ­¥'

permissions:
  contents: write 

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: MSVC Extreme Build
        shell: cmd
        run: |
          call "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\VC\Auxiliary\Build\vcvars64.bat"
          :: /O1 æœ€å°ä½“ç§¯ /MT é™æ€é“¾æ¥
          cl.exe /O1 /MT /utf-8 /DNDEBUG client.c /link /OUT:Control.exe user32.lib gdi32.lib ws2_32.lib ole32.lib shell32.lib
          cl.exe /O1 /MT /utf-8 /DNDEBUG server.c /link /OUT:Service.exe user32.lib gdi32.lib ws2_32.lib d3d11.lib dxgi.lib advapi32.lib ole32.lib

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            Control.exe
            Service.exe
          tag_name: ${{ github.event.inputs.version_tag }}
          name: "Release ${{ github.event.inputs.version_tag }}"
          body: |
            ### ğŸ›  æ‰‹åŠ¨è§¦å‘ç¼–è¯‘è¯´æ˜
            - **ç‰ˆæœ¬**: ${{ github.event.inputs.version_tag }}
            - **è¯´æ˜**: ${{ github.event.inputs.release_note }}
            ---
            - **ä½“ç§¯**: æè‡´å‹ç¼© (<200KB)
            - **ç‰¹æ€§**: P2P/DXGI/é”å±çªç ´/å‰ªè´´æ¿/å¯†ä¿¡åŠ å¯†
          draft: false
          prerelease: false
